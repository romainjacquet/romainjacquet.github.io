<!doctype html>
<html lang="en" itemscope itemtype="http://schema.org/Person">
<head>
            <meta charset="utf-8">
        <!-- Site Meta Data -->
        <title>Zabbix Agent on centos 7.3 (2/2)</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Romain JACQUET">

        <link rel="shortcut icon" href="">

        <!-- schema.org -->
        <meta itemprop="name" content="Deep in the system">
        <meta itemprop="image" content="">
        <meta itemprop="description" content="">

        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>
        <!-- Style Meta Data -->
        <link rel="stylesheet" href="https://romainjacquet.github.io/theme/css/style.css" type="text/css"/>
        <link rel="stylesheet" href="https://romainjacquet.github.io/theme/css/pygments.css" type="text/css"/>

        <!-- Feed Meta Data -->
            <link href="https://romainjacquet.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
                  title="Deep in the system ATOM Feed"/>

        <!-- Twitter Feed -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="">
        <meta name="twitter:image" content="">

    <meta name="twitter:creator" content="">
    <meta name="twitter:url" content="https://romainjacquet.github.io/zabbix-agent-on-centos-73-22.html">
    <meta name="twitter:title" content="Deep in the system ~ Zabbix Agent on centos 7.3 (2/2)">
    <meta name="twitter:description" content="installing zabbix on CentOS 7.3 (2/2)">

    <!-- Facebook Meta Data -->
    <meta property="og:title" content="Deep in the system ~ Zabbix Agent on centos 7.3 (2/2)"/>
    <meta property="og:description" content="installing zabbix on CentOS 7.3 (2/2)"/>
    <meta property="og:image" content=""/>
</head>

<body>
<!-- Sidebar -->
<aside>
    <!--<center><a href="https://romainjacquet.github.io"><img id="avatar" src=""></a></center>-->
    <h1>Deep in the system</h1>
        <p>Unix, sysadmin, devops, CI/CD</p>
    <br>


    <nav class="nav">
        <ul class="list-bare">

                <li><a class="nav__link" href="/">Blog entry</a></li>

                <li><a class="nav__link" href="https://romainjacquet.github.io/pages/about.html">About</a></li>
                <li><a class="nav__link" href="https://romainjacquet.github.io/pages/links.html">Links</a></li>

        </ul>
    </nav>

    <p class="social">
                <a href="https://www.linkedin.com/in/jacquet-romain-493049141/?locale=en_US" target="_blank"><img
                        src="https://romainjacquet.github.io/theme/images/icons/linkedin.png"></a>
                <a href="https://github.com/romainjacquet" target="_blank"><img
                        src="https://romainjacquet.github.io/theme/images/icons/github.png"></a>
                <a href="mailto:romainjacquet@free.fr" target="_blank"><img
                        src="https://romainjacquet.github.io/theme/images/icons/mail.png"></a>
            <a href="https://romainjacquet.github.io/feeds/all.atom.xml" rel="alternate">
                <img src="https://romainjacquet.github.io/theme/images/icons/rss.png"></a>
    </p>

        <h2>Categories</h2>
        <ul class="navbar">
                <li><a
                        href="https://romainjacquet.github.io/category/business.html">business</a></li>
                <li><a
                        href="https://romainjacquet.github.io/category/cicd.html">ci/cd</a></li>
                <li><a
                        href="https://romainjacquet.github.io/category/development.html">development</a></li>
                <li class="active"><a
                        href="https://romainjacquet.github.io/category/sysadmin.html">sysadmin</a></li>
        </ul>

        <h2 class="blog_roll_link"><br/>BLOGROLLS</h2>
        <ul class="navbar">
                <li><a href="http://getpelican.com/">Pelican</a></li>
                <li><a href="http://python.org/">Python.org</a></li>
                <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
        </ul>

</aside>

<!-- Content -->
<article>
    <section id="content">
        <article>
            <h2 class="post_title post_detail"><a href="https://romainjacquet.github.io/zabbix-agent-on-centos-73-22.html" rel="bookmark"
                                                  title="Permalink to Zabbix Agent on centos 7.3 (2/2)">Zabbix Agent on centos 7.3 (2/2)</a></h2>
            <div class="entry-content blog-post">
                <p>I finished the previous post with a catastrophic situation: the VM didn't boot.
I read on the internet that adding "selinux=0" on the kernel command line could fix it.
Disabling SELinux from the kernel command line is interesting because SELinux is disabled
at the early beginning of the boot process. So event if you have a broken configuration of
SELinux, you can bypass it and boot.
Below is the official definition of the kernel argument:</p>
<div class="highlight"><pre><span></span> <span class="nv">selinux</span><span class="o">=</span>        [<span class="nv">SELINUX</span>] <span class="nv">Disable</span> <span class="nv">or</span> <span class="nv">enable</span> <span class="nv">SELinux</span> <span class="nv">at</span> <span class="nv">boot</span> <span class="nv">time</span>.
                        <span class="nv">Format</span>: { <span class="s2">&quot;</span><span class="s">0</span><span class="s2">&quot;</span> <span class="o">|</span> <span class="s2">&quot;</span><span class="s">1</span><span class="s2">&quot;</span> }
                        <span class="nv">See</span> <span class="nv">security</span><span class="o">/</span><span class="nv">selinux</span><span class="o">/</span><span class="nv">Kconfig</span> <span class="nv">help</span> <span class="nv">text</span>.
                        <span class="mi">0</span> <span class="o">--</span> <span class="nv">disable</span>.
                        <span class="mi">1</span> <span class="o">--</span> <span class="nv">enable</span>.
                        <span class="nv">Default</span> <span class="nv">value</span> <span class="nv">is</span> <span class="nv">set</span> <span class="nv">via</span> <span class="nv">kernel</span> <span class="nv">config</span> <span class="nv">option</span>.
                        <span class="k">If</span> <span class="nv">enabled</span> <span class="nv">at</span> <span class="nv">boot</span> <span class="nv">time</span>, <span class="o">/</span><span class="nv">selinux</span><span class="o">/</span><span class="nv">disable</span> <span class="nv">can</span> <span class="nv">be</span> <span class="nv">used</span>
                        <span class="nv">later</span> <span class="nv">to</span> <span class="nv">disable</span> <span class="nv">prior</span> <span class="nv">to</span> <span class="nv">initial</span> <span class="nv">policy</span> <span class="nv">load</span>.
</pre></div>


<p>I reboot the server and edit the command line to append "selinux=0".
I checked the content of /etc/selinux.config:</p>
<div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">This</span> <span class="n">file</span> <span class="n">controls</span> <span class="n">the</span> <span class="k">state</span> <span class="k">of</span> <span class="n">SELinux</span> <span class="k">on</span> <span class="n">the</span> <span class="k">system</span><span class="p">.</span>
<span class="o">#</span> <span class="n">SELINUX</span><span class="o">=</span> <span class="n">can</span> <span class="n">take</span> <span class="n">one</span> <span class="k">of</span> <span class="n">these</span> <span class="n">three</span> <span class="k">values</span><span class="p">:</span>
<span class="o">#</span>     <span class="n">enforcing</span> <span class="o">-</span> <span class="n">SELinux</span> <span class="k">security</span> <span class="n">policy</span> <span class="k">is</span> <span class="n">enforced</span><span class="p">.</span>
<span class="o">#</span>     <span class="n">permissive</span> <span class="o">-</span> <span class="n">SELinux</span> <span class="n">prints</span> <span class="n">warnings</span> <span class="k">instead</span> <span class="k">of</span> <span class="n">enforcing</span><span class="p">.</span>
<span class="o">#</span>     <span class="n">disabled</span> <span class="o">-</span> <span class="k">No</span> <span class="n">SELinux</span> <span class="n">policy</span> <span class="k">is</span> <span class="n">loaded</span><span class="p">.</span>
<span class="n">SELINUX</span><span class="o">=</span><span class="n">enforcing</span>
<span class="o">#</span> <span class="n">SELINUXTYPE</span><span class="o">=</span> <span class="n">can</span> <span class="n">take</span> <span class="n">one</span> <span class="k">of</span> <span class="n">three</span> <span class="n">two</span> <span class="k">values</span><span class="p">:</span>
<span class="o">#</span>     <span class="n">targeted</span> <span class="o">-</span> <span class="n">Targeted</span> <span class="n">processes</span> <span class="k">are</span> <span class="n">protected</span><span class="p">,</span>
<span class="o">#</span>     <span class="n">minimum</span> <span class="o">-</span> <span class="n">Modification</span> <span class="k">of</span> <span class="n">targeted</span> <span class="n">policy</span><span class="p">.</span> <span class="k">Only</span> <span class="n">selected</span> <span class="n">processes</span> <span class="k">are</span> <span class="n">protected</span><span class="p">.</span>
<span class="o">#</span>     <span class="n">mls</span> <span class="o">-</span> <span class="n">Multi</span> <span class="k">Level</span> <span class="k">Security</span> <span class="n">protection</span><span class="p">.</span>
<span class="n">SELINUXTYPE</span><span class="o">=</span><span class="n">disabled</span>
</pre></div>


<p>Damn it! SELINUXTYPE contains invalid value. This is the cause of the boot failure. After
replacing SELINUX=enforcing by SELINUX=disabled and SELINUXTYPE=disabled by SELINUXTYPE=targeted, boot is fine.</p>
<h2>final note</h2>
<p>A better solution is available to fix and respect SELinux:
<a href="https://www.mangeek.com/2017/03/using-zabbix-3-2-with-centos-and-selinux/">Man geek Zabbix and SeLinux</a>
It uses the python utils <a href="https://github.com/SELinuxProject/selinux/tree/master/python/audit2allow">audit2allow</a>
which is part of the SELinux project. Other people says that just upgrading the SELinux policy solved the problem
but I didn't take the risk.</p>
            </div>
            <div class="post_list">
                <span>By </span>
                <a href="https://romainjacquet.github.io/author/romain-jacquet.html">@Romain JACQUET</a>
                <span> in </span>
                <span class="post_category"><a href="https://romainjacquet.github.io/category/sysadmin.html" rel="bookmark"
                                               title="Permalink to sysadmin">[ sysadmin ]</a></span>
                <span class="post_date">lun. 11 mars 2019</span>
                <div><span>Tags : </span>
                </div>

                <div class="entry-social">
                    <span class="twitter"><a target="_blank" rel="nofollow"
                                             onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=700');return false;"
                                             title="Twitter"
                                             href="https://twitter.com/share?url=https://romainjacquet.github.io/zabbix-agent-on-centos-73-22.html&text=Zabbix Agent on centos 7.3 (2/2)&via="><img
                            src="https://romainjacquet.github.io/theme/images/icons/twitter-s.png"></a></span>

                    <span class="gplus"><a target="_blank" title="Google +"
                                           href="https://plus.google.com/share?url=https://romainjacquet.github.io/zabbix-agent-on-centos-73-22.html&hl=fr"
                                           rel="nofollow"
                                           onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img
                            src="https://romainjacquet.github.io/theme/images/icons/google-s.png"></a></span>

                    <span class="facebook"><a target="_blank" title="Facebook" rel="nofollow"
                                              onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700');return false;"
                                              href="https://www.facebook.com/sharer.php?u=https://romainjacquet.github.io/zabbix-agent-on-centos-73-22.html&t=Zabbix Agent on centos 7.3 (2/2)"><img
                            src="https://romainjacquet.github.io/theme/images/icons/facebook-s.png"></a></span>

                    <a target="_blank" title="Linkedin"
                       href="https://www.linkedin.com/shareArticle?mini=true&url=https://romainjacquet.github.io/zabbix-agent-on-centos-73-22.html&title=Zabbix Agent on centos 7.3 (2/2)"
                       rel="nofollow"
                       onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img
                            src="https://romainjacquet.github.io/theme/images/icons/linkedin-s.png"></a>

                    <span class="mail"><a
                            href="mailto:?subject=Zabbix Agent on centos 7.3 (2/2)&amp;body=Viens découvrir un article à propos de [Zabbix Agent on centos 7.3 (2/2)] sur le site de Romain JACQUET. https://romainjacquet.github.io/zabbix-agent-on-centos-73-22.html"
                            title="Share by Email" target="_blank"><img
                            src="https://romainjacquet.github.io/theme/images/icons/mail-s.png"></a></span>
                </div>
            </div>
        </article>
    </section>
</article>

<!-- Footer -->
    <footer>
        <p>
            <a href="http://getpelican.com/">Pelican</a> theme
            based on <a href="https://github.com/parbhat/pelican-blue">Pelican-Blue</a> by <a
                href="https://parbhatpuri.com/">@parbhat</a> with minor changes.
        </p>
    </footer>


</body>
</html>