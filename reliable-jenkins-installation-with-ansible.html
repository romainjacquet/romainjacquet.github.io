<!doctype html>
<html lang="en" itemscope itemtype="http://schema.org/Person">
<head>
            <meta charset="utf-8">
        <!-- Site Meta Data -->
        <title>Reliable Jenkins installation with ansible</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Romain JACQUET">

        <link rel="shortcut icon" href="">

        <!-- schema.org -->
        <meta itemprop="name" content="Deep in the system">
        <meta itemprop="image" content="">
        <meta itemprop="description" content="">

        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>
        <!-- Style Meta Data -->
        <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>
        <link rel="stylesheet" href="/theme/css/pygments.css" type="text/css"/>

        <!-- Feed Meta Data -->

        <!-- Twitter Feed -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="">
        <meta name="twitter:image" content="">

    <meta name="twitter:creator" content="">
    <meta name="twitter:url" content="/reliable-jenkins-installation-with-ansible.html">
    <meta name="twitter:title" content="Deep in the system ~ Reliable Jenkins installation with ansible">
    <meta name="twitter:description" content="Infra-as-code required a stable environment">

    <!-- Facebook Meta Data -->
    <meta property="og:title" content="Deep in the system ~ Reliable Jenkins installation with ansible"/>
    <meta property="og:description" content="Infra-as-code required a stable environment"/>
    <meta property="og:image" content=""/>
</head>

<body>
<!-- Sidebar -->
<aside>
    <!--<center><a href=""><img id="avatar" src=""></a></center>-->
    <h1>Deep in the system</h1>
        <p>Unix, sysadmin, devops, CI/CD</p>
    <br>


    <nav class="nav">
        <ul class="list-bare">

                <li><a class="nav__link" href="/">Blog entry</a></li>

                <li><a class="nav__link" href="/pages/about.html">About</a></li>
                <li><a class="nav__link" href="/pages/links.html">Links</a></li>

        </ul>
    </nav>

    <p class="social">
                <a href="https://www.linkedin.com/in/jacquet-romain-493049141/?locale=en_US" target="_blank"><img
                        src="/theme/images/icons/linkedin.png"></a>
                <a href="https://github.com/romainjacquet" target="_blank"><img
                        src="/theme/images/icons/github.png"></a>
                <a href="mailto:romainjacquet@free.fr" target="_blank"><img
                        src="/theme/images/icons/mail.png"></a>
    </p>

        <h2>Categories</h2>
        <ul class="navbar">
                <li class="active"><a
                        href="/category/cicd.html">ci/cd</a></li>
                <li><a
                        href="/category/development.html">development</a></li>
                <li><a
                        href="/category/sysadmin.html">sysadmin</a></li>
        </ul>

        <h2 class="blog_roll_link"><br/>BLOGROLLS</h2>
        <ul class="navbar">
                <li><a href="http://getpelican.com/">Pelican</a></li>
                <li><a href="http://python.org/">Python.org</a></li>
                <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
        </ul>

</aside>

<!-- Content -->
<article>
    <section id="content">
        <article>
            <h2 class="post_title post_detail"><a href="/reliable-jenkins-installation-with-ansible.html" rel="bookmark"
                                                  title="Permalink to Reliable Jenkins installation with ansible">Reliable Jenkins installation with ansible</a></h2>
            <div class="entry-content blog-post">
                <p>I like using <a href="https://www.ansible.com/">ansible</a>, because it provides a reproductible way to
install servers. This is reproductible ... in the theory. This week I get stuck with the
reinstallation of a server. I was confident because we are using ansible and I had already
made a dozen of installation. But as usual, unexpected events occured :-).
The ansible playbook failed with this type of errors:</p>
<ul>
<li>Failed to fetch the yum repository key at <code>https://jenkins-ci.org/redhat/jenkins-ci.org.key</code></li>
<li>Impossible to download some jenkins' plugin. <code>Failed to connect to updates.jenkins-ci.org at port 443: [Errno 104]</code></li>
</ul>
<p>It is a network problem that could be reproduced by a simple oneliner:</p>
<div class="highlight"><pre><span></span><span class="cp">[</span><span class="nx">root</span><span class="p">@</span><span class="nx">vmt</span><span class="na">-jenkins</span> <span class="err">~</span><span class="cp">]</span><span class="err">#</span> <span class="nt">LANG</span><span class="o">=</span> <span class="nt">curl</span> <span class="nt">-XGET</span> <span class="nt">-v</span> <span class="nt">-L</span> <span class="nt">https</span><span class="o">://</span><span class="nt">jenkins-ci</span><span class="p">.</span><span class="nc">org</span><span class="o">/</span><span class="nt">redhat</span><span class="o">/</span><span class="nt">jenkins-ci</span><span class="p">.</span><span class="nc">org</span><span class="p">.</span><span class="nc">key</span>
<span class="o">*</span> <span class="nt">About</span> <span class="nt">to</span> <span class="nt">connect</span><span class="o">()</span> <span class="nt">to</span> <span class="nt">jenkins-ci</span><span class="p">.</span><span class="nc">org</span> <span class="nt">port</span> <span class="nt">443</span> <span class="o">(</span><span class="p">#</span><span class="nn">0</span><span class="o">)</span>
<span class="cp">[</span><span class="nx">...</span><span class="cp">]</span>
<span class="o">*</span> <span class="nt">Ignoring</span> <span class="nt">the</span> <span class="nt">response-body</span>
<span class="o">*</span> <span class="nt">Connection</span> <span class="p">#</span><span class="nn">2</span> <span class="nt">to</span> <span class="nt">host</span> <span class="nt">jenkins</span><span class="p">.</span><span class="nc">io</span> <span class="nt">left</span> <span class="nt">intact</span>
<span class="o">*</span> <span class="nt">Issue</span> <span class="nt">another</span> <span class="nt">request</span> <span class="nt">to</span> <span class="nt">this</span> <span class="nt">URL</span><span class="o">:</span> <span class="s1">&#39;https://pkg.jenkins.io/redhat/jenkins-ci.org.key&#39;</span>
<span class="o">*</span> <span class="nt">About</span> <span class="nt">to</span> <span class="nt">connect</span><span class="o">()</span> <span class="nt">to</span> <span class="nt">pkg</span><span class="p">.</span><span class="nc">jenkins</span><span class="p">.</span><span class="nc">io</span> <span class="nt">port</span> <span class="nt">443</span> <span class="o">(</span><span class="p">#</span><span class="nn">3</span><span class="o">)</span>
<span class="o">*</span>   <span class="nt">Trying</span> <span class="nt">52</span><span class="p">.</span><span class="nc">202</span><span class="p">.</span><span class="nc">51</span><span class="p">.</span><span class="nc">185</span><span class="o">...</span>
<span class="o">*</span> <span class="nt">Connection</span> <span class="nt">timed</span> <span class="nt">out</span>
<span class="o">*</span> <span class="nt">Failed</span> <span class="nt">connect</span> <span class="nt">to</span> <span class="nt">pkg</span><span class="p">.</span><span class="nc">jenkins</span><span class="p">.</span><span class="nc">io</span><span class="p">:</span><span class="nd">443</span><span class="o">;</span> <span class="nt">Connection</span> <span class="nt">timed</span> <span class="nt">out</span>
<span class="o">*</span> <span class="nt">Closing</span> <span class="nt">connection</span> <span class="nt">3</span>
<span class="nt">curl</span><span class="o">:</span> <span class="o">(</span><span class="nt">7</span><span class="o">)</span> <span class="nt">Failed</span> <span class="nt">connect</span> <span class="nt">to</span> <span class="nt">pkg</span><span class="p">.</span><span class="nc">jenkins</span><span class="p">.</span><span class="nc">io</span><span class="p">:</span><span class="nd">443</span><span class="o">;</span> <span class="nt">Connection</span> <span class="nt">timed</span> <span class="nt">out</span>
</pre></div>


<p>At this point, I realized that a broken environment prevent me from installing my server and
I start to find solution to mitigate these issues.
To be resilient of this kind of failure, my advises are:</p>
<ul>
<li>If you are using an additionnal repository (in my case
 http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo)
try to write an Ansible playbook that can use a mirror.This can be done by using a variable with
containing the URL of the mirror.</li>
<li>Identify the required services of your application and setup a good monitoring. In my case,
 monitoring the jenkins repository health sound weird as it is an official repository and we
expect that it is always running. Monitoring could give you an exact situation of the repository
health: never broken, sometimes broken, always up.</li>
<li>Regularly run you playbook. We have seen that unexpected failure could happened and debugging
 installation is an important skill. To be good in debugging install you must work on installation 
 failure!</li>
<li>Write the most reliable playbook possible. Catch the errors and if possible retry the command. It's
sometimes impossible</li>
<li>Do not forget to backup the running hosts even if you are using infra-as-code. Because if 
your playbook fails you will be happy to restore a backup.</li>
</ul>
<p>Systems using infra-as-code are really cool. But in case of network
or internet failure, remember that you may be trapped with no
possiblity to installation. This is important especially if you are running on-premises servers.</p>
            </div>
            <div class="post_list">
                <span>By </span>
                <a href="/author/romain-jacquet.html">@Romain JACQUET</a>
                <span> in </span>
                <span class="post_category"><a href="/category/cicd.html" rel="bookmark"
                                               title="Permalink to ci/cd">[ ci/cd ]</a></span>
                <span class="post_date">ven. 05 juillet 2019</span>
                <div><span>Tags : </span>
                </div>

                <div class="entry-social">
                    <span class="twitter"><a target="_blank" rel="nofollow"
                                             onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=700');return false;"
                                             title="Twitter"
                                             href="https://twitter.com/share?url=/reliable-jenkins-installation-with-ansible.html&text=Reliable Jenkins installation with ansible&via="><img
                            src="/theme/images/icons/twitter-s.png"></a></span>

                    <span class="gplus"><a target="_blank" title="Google +"
                                           href="https://plus.google.com/share?url=/reliable-jenkins-installation-with-ansible.html&hl=fr"
                                           rel="nofollow"
                                           onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img
                            src="/theme/images/icons/google-s.png"></a></span>

                    <span class="facebook"><a target="_blank" title="Facebook" rel="nofollow"
                                              onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700');return false;"
                                              href="https://www.facebook.com/sharer.php?u=/reliable-jenkins-installation-with-ansible.html&t=Reliable Jenkins installation with ansible"><img
                            src="/theme/images/icons/facebook-s.png"></a></span>

                    <a target="_blank" title="Linkedin"
                       href="https://www.linkedin.com/shareArticle?mini=true&url=/reliable-jenkins-installation-with-ansible.html&title=Reliable Jenkins installation with ansible"
                       rel="nofollow"
                       onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img
                            src="/theme/images/icons/linkedin-s.png"></a>

                    <span class="mail"><a
                            href="mailto:?subject=Reliable Jenkins installation with ansible&amp;body=Viens découvrir un article à propos de [Reliable Jenkins installation with ansible] sur le site de Romain JACQUET. /reliable-jenkins-installation-with-ansible.html"
                            title="Share by Email" target="_blank"><img
                            src="/theme/images/icons/mail-s.png"></a></span>
                </div>
            </div>
        </article>
    </section>
</article>

<!-- Footer -->
    <footer>
        <p>
            Blog powered by <a href="http://getpelican.com/">Pelican</a>,
            which takes great advantage of <a href="http://python.org">Python</a>.
            Theme <a href="https://github.com/parbhat/pelican-blue">Pelican-Blue</a> by <a
                href="https://parbhatpuri.com/">@parbhat</a>.
        </p>
    </footer>


</body>
</html>